<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Manual | cURL Builder</title>

  <!-- Bootstrap (แค่ CSS; ถ้าโหลดไม่ได้ก็ยังใช้งานได้) -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- jQuery + fallback ไปไฟล์โลคอล js/jquery-3.7.1.min.js -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script>
    if (!window.jQuery) {
      document.write('<div class="alert alert-warning m-2">CDN jQuery โหลดไม่ขึ้น — ใช้ไฟล์โลคอลแทน (ใส่ไว้ที่ <code>js/jquery-3.7.1.min.js</code>)</div>');
      document.write('<script src="js/jquery-3.7.1.min.js"><\/script>');
    }
  </script>

  <style>
    body { background:#0f1115; color:#e6e8ef; }
    .navbar { background:#151823 !important; }
    .form-control, .form-select, .btn { background:#1a2030; color:#e6e8ef; border-color:#2a334b; }
    pre { background:#0b0e14; color:#e6e8ef; }
    .section-card { border:1px solid #2a334b; border-radius:1rem; padding:1rem; background:#141a29; }
    code { color:#c7d2fe; }
  </style>
</head>
<body>
  <!-- Navbar -->
<!-- Navbar (ใส่แทนของเดิมใน manual.html) -->
<nav class="navbar navbar-expand-lg navbar-dark" style="background:#151823">
  <div class="container-fluid">
    <a class="navbar-brand fw-semibold" href="manual.html">Manual</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navMain">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div id="navMain" class="collapse navbar-collapse">
      <ul class="navbar-nav me-auto">
        <li class="nav-item"><a class="nav-link active" href="manual.html">curl</a></li>
        <li class="nav-item"><a class="nav-link" href="bash.html">Bash</a></li>
 <li class="nav-item"><a class="nav-link" href="nvim.html">Neovim</a></li>

        <li class="nav-item"><a class="nav-link disabled" aria-disabled="true" href="#">(เร็วๆ นี้) manuals อื่น</a></li>
      </ul>
      <span class="navbar-text text-muted">Manuals • jQuery + Bootstrap</span>
    </div>
  </div>
</nav>


  <noscript>
    <div class="alert alert-danger m-3">ต้องเปิดใช้งาน JavaScript เพื่อแสดงคำสั่ง cURL แบบเรียลไทม์</div>
  </noscript>

  <div class="container my-4">
    <div class="row g-4">
      <!-- Form -->
      <div class="col-12 col-lg-6">
        <div class="section-card">
          <h5 class="mb-3">ตั้งค่า request</h5>

          <div class="mb-3">
            <label class="form-label">URL</label>
            <input id="url" type="text" class="form-control" placeholder="http://localhost:5000/ai">
          </div>

          <div class="row g-2 mb-3">
            <div class="col-6">
              <label class="form-label">Method</label>
              <select id="method" class="form-select">
                <option>POST</option><option>GET</option><option>PUT</option>
                <option>PATCH</option><option>DELETE</option>
              </select>
            </div>
            <div class="col-6">
              <label class="form-label">ตัวเลือก cURL</label>
              <div class="d-flex flex-wrap gap-3">
                <div class="form-check"><input class="form-check-input" type="checkbox" id="optSilent" checked><label class="form-check-label" for="optSilent">-s</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="optInclude"><label class="form-check-label" for="optInclude">-i</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="optVerbose"><label class="form-check-label" for="optVerbose">-v</label></div>
                <div class="form-check"><input class="form-check-input" type="checkbox" id="optFollow"><label class="form-check-label" for="optFollow">-L</label></div>
              </div>
            </div>
          </div>

          <div class="mb-3">
            <div class="d-flex justify-content-between align-items-center">
              <label class="form-label mb-0">Headers</label>
              <button id="addHeader" class="btn btn-sm btn-outline-secondary">+ Header</button>
            </div>
            <div id="headerList" class="mt-2"></div>
          </div>

          <div class="mb-2 d-flex justify-content-between align-items-center">
            <label class="form-label mb-0">Body</label>
            <select id="bodyType" class="form-select form-select-sm" style="max-width:220px">
              <option value="json">JSON</option>
              <option value="raw">raw</option>
              <option value="none">none</option>
            </select>
          </div>

          <div id="bodyJSON" class="mb-3">
            <textarea id="jsonBody" class="form-control" rows="6" placeholder='{"sentence":"สวัสดี"}'></textarea>
          </div>
          <div id="bodyRAW" class="mb-3" style="display:none;">
            <textarea id="rawBody" class="form-control" rows="6" placeholder="raw body..."></textarea>
          </div>

          <div class="mb-3">
            <div class="form-check form-switch">
              <input class="form-check-input" type="checkbox" id="pipeJq" checked>
              <label class="form-check-label" for="pipeJq">pipe ไป jq</label>
            </div>
            <div class="d-flex gap-2 align-items-center mt-2">
              <div class="form-check">
                <input class="form-check-input" type="checkbox" id="jqRaw" checked>
                <label class="form-check-label" for="jqRaw">-r</label>
              </div>
              <input id="jqFilter" type="text" class="form-control" style="max-width:240px" value=".response">
            </div>
          </div>

          <div class="d-flex gap-2">
            <button id="btnReset" class="btn btn-secondary">รีเซ็ตตัวอย่าง</button>
          </div>
        </div>
      </div>

      <!-- Preview -->
      <div class="col-12 col-lg-6">
        <div class="section-card">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="mb-0">คำสั่ง cURL</h5>
            <div class="d-flex gap-2">
              <button id="btnCopyML" class="btn btn-outline-secondary btn-sm">คัดลอก (หลายบรรทัด)</button>
              <button id="btnCopyOL" class="btn btn-outline-secondary btn-sm">คัดลอก (บรรทัดเดียว)</button>
            </div>
          </div>

          <div class="mb-2">
            <span class="text-muted">URL ที่ประกอบแล้ว:</span>
            <div><code id="urlPreview">—</code></div>
          </div>

          <div class="form-check form-switch mb-2">
            <input class="form-check-input" type="checkbox" id="toggleMultiline" checked>
            <label class="form-check-label" for="toggleMultiline">แสดงแบบหลายบรรทัด (มี <code>\</code>)</label>
          </div>

          <pre id="curlPreview" class="p-3 rounded" style="min-height:200px">กำลังเตรียมตัวอย่าง...</pre>
        </div>
      </div>
    </div>
  </div>

  <script>
    // ---------- helpers ----------
    const rowTpl = () => $(`
      <div class="row g-2 align-items-center mb-2 list-row">
        <div class="col-5"><input type="text" class="form-control key" placeholder="Header"></div>
        <div class="col-6"><input type="text" class="form-control val" placeholder="Value"></div>
        <div class="col-1 text-end"><button type="button" class="btn btn-sm btn-outline-secondary btn-remove" title="remove">✕</button></div>
      </div>
    `);

    const bashQ = (s) => "'" + String(s).replace(/'/g, `'\"'\"'`) + "'";

    function collectHeaders() {
      const list = [];
      $("#headerList .list-row").each(function() {
        const k = $(this).find(".key").val().trim();
        const v = $(this).find(".val").val();
        if (k) list.push({k, v});
      });
      return list;
    }

    function ensureCT(headers, bodyType) {
      const has = headers.some(h => h.k.toLowerCase() === "content-type");
      if (!has && bodyType === "json") headers.push({k:"Content-Type", v:"application/json"});
      return headers;
    }

    async function copyText(txt) {
      try {
        await navigator.clipboard.writeText(txt);
      } catch {
        // fallback
        const ta = document.createElement('textarea');
        ta.value = txt; document.body.appendChild(ta);
        ta.select(); document.execCommand('copy'); ta.remove();
      }
    }

    // ---------- core ----------
    function renderCurl() {
      const url = $("#url").val().trim();
      const method = $("#method").val();
      const opt = {
        s: $("#optSilent").is(":checked"),
        i: $("#optInclude").is(":checked"),
        v: $("#optVerbose").is(":checked"),
        L: $("#optFollow").is(":checked"),
      };
      const bodyType = $("#bodyType").val();

      let headers = collectHeaders();
      headers = ensureCT(headers, bodyType);

      $("#urlPreview").text(url || "—");

      const parts = ["curl"];
      if (opt.s) parts.push("-s");
      if (opt.i) parts.push("-i");
      if (opt.v) parts.push("-v");
      if (opt.L) parts.push("-L");

      parts.push("-X", method);
      if (url) parts.push(bashQ(url));

      headers.forEach(h => parts.push("-H", bashQ(`${h.k}: ${h.v ?? ""}`)));

      if (["POST","PUT","PATCH","DELETE"].includes(method)) {
        if (bodyType === "json") {
          const body = $("#jsonBody").val();
          if (body) parts.push("--data-raw", bashQ(body));
        } else if (bodyType === "raw") {
          const raw = $("#rawBody").val();
          if (raw) parts.push("--data-raw", bashQ(raw));
        }
      }

      let jqPipe = "";
      if ($("#pipeJq").is(":checked")) {
        jqPipe = " | jq " + ($("#jqRaw").is(":checked") ? "-r " : "") + ($("#jqFilter").val().trim() || ".");
      }

      const oneLine = parts.join(" ") + jqPipe;

      // multiline
      let multi = "curl";
      const rest = parts.slice(1);
      for (let i=0; i<rest.length; i++) multi += ` \\\n  ${rest[i]}`;
      multi += jqPipe;

      $("#curlPreview").text($("#toggleMultiline").is(":checked") ? multi : oneLine);
      return {oneLine, multi};
    }

    function setDefaults() {
      $("#url").val("http://localhost:5000/ai");
      $("#method").val("POST");
      $("#optSilent").prop("checked", true);
      $("#optInclude, #optVerbose, #optFollow").prop("checked", false);

      $("#headerList").empty();
      const r = rowTpl(); r.find(".key").val("Content-Type"); r.find(".val").val("application/json"); $("#headerList").append(r);

      $("#bodyType").val("json");
      $("#jsonBody").val('{"sentence":"สวัสดี"}');
      $("#rawBody").val("");

      $("#pipeJq").prop("checked", true);
      $("#jqRaw").prop("checked", true);
      $("#jqFilter").val(".response");

      $("#toggleMultiline").prop("checked", true);
    }

    // ---------- events ----------
    $(document).on("input change", "input, textarea, select", renderCurl);
    $("#addHeader").on("click", () => { $("#headerList").append(rowTpl()); renderCurl(); });
    $(document).on("click", ".btn-remove", function(){ $(this).closest(".list-row").remove(); renderCurl(); });

    $("#bodyType").on("change", () => {
      const t = $("#bodyType").val();
      $("#bodyJSON, #bodyRAW").hide();
      if (t === "json") $("#bodyJSON").show();
      if (t === "raw")  $("#bodyRAW").show();
      renderCurl();
    });

    $("#method").on("change", () => {
      if (["GET"].includes($("#method").val())) {
        $("#bodyType").val("none").trigger("change");
      } else if ($("#bodyType").val()==="none") {
        $("#bodyType").val("json").trigger("change");
      }
    });

    $("#btnReset").on("click", () => { setDefaults(); renderCurl(); });
    $("#btnCopyML").on("click", () => { const r = renderCurl(); copyText(r.multi); });
    $("#btnCopyOL").on("click", () => { const r = renderCurl(); copyText(r.oneLine); });

    // ---------- init ----------
    $(function(){
      setDefaults();
      renderCurl();
    });
  </script>
</body>
</html>

